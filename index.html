<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基于自适应光学校正的望远镜单模耦合效率分析</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-bg: #0a0e17;
            --secondary-bg: #121a2b;
            --accent-blue: #1a73e8;
            --accent-purple: #8a2be2;
            --accent-cyan: #00bcd4;
            --accent-green: #4caf50;
            --accent-orange: #ff9800;
            --accent-red: #f44336;
            --text-light: #e0e0e0;
            --text-lighter: #ffffff;
            --border-color: #2a3a5c;
            --card-bg: rgba(26, 35, 58, 0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-bg) 0%, #152642 100%);
            color: var(--text-light);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            background: var(--card-bg);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            background: var(--secondary-bg);
            color: var(--accent-cyan);
            border-bottom: 3px solid var(--accent-cyan);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-content {
            display: none;
            background: var(--card-bg);
            border-radius: 0 0 10px 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tab-content.active {
            display: block;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        h1,
        h2,
        h3 {
            color: var(--text-lighter);
            margin-bottom: 15px;
            font-weight: 600;
        }

        h1 {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .param-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .param-item {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--accent-cyan);
            font-size: 0.85rem;
        }

        input,
        select {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            background: rgba(10, 20, 40, 0.7);
            color: var(--text-light);
            transition: all 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }

        button {
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 3px;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(138, 43, 226, 0.4);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            font-size: 12px;
            padding: 6px 12px;
        }

        button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .error-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 1600px) {
            .error-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .error-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .param-group,
            .results-grid {
                grid-template-columns: 1fr;
            }

            .chart-controls {
                flex-direction: column;
            }

            .tab-buttons {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .content-container {
                flex-direction: column;
            }

            .left-panel {
                flex: none;
            }
        }

        .result-card {
            background: rgba(15, 25, 50, 0.8);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-cyan);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .result-value {
            font-size: 28px;
            font-weight: 700;
            margin: 10px 0;
            color: var(--text-lighter);
        }

        .result-desc {
            color: #a0a0a0;
            font-size: 14px;
        }

        .intermediate-vars {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .var-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
        }

        .var-name {
            color: #b0b0b0;
        }

        .var-value {
            font-weight: 600;
            color: var(--text-lighter);
        }

        .chart-container {
            height: 400px;
            margin-top: 20px;
            background: rgba(15, 25, 50, 0.5);
            border-radius: 8px;
            padding: 15px;
        }

        .chart-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .chart-control-item {
            display: flex;
            flex-direction: column;
            min-width: 100px;
        }

        .single-chart-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .data-flow-diagram {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .data-flow-group {
            background: rgba(15, 25, 50, 0.8);
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid var(--accent-cyan);
        }

        .data-flow-title {
            font-weight: 600;
            color: var(--accent-cyan);
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 5px;
        }

        .data-flow-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
        }

        .scenario-description {
            background: rgba(15, 25, 50, 0.8);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            line-height: 1.8;
        }

        .scenario-highlight {
            color: var(--accent-cyan);
            font-weight: 600;
        }

        .formula-card {
            background: rgba(15, 25, 50, 0.8);
            border-radius: 8px;
            padding: 25px;
            margin: 15px 0;
            border-left: 4px solid var(--accent-cyan);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .formula-expression {
            font-family: 'Cambria Math', 'Times New Roman', serif;
            font-size: 1.4em;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            color: #e0e0e0;
            line-height: 1.6;
        }

        .formula-explanation {
            color: #b0b0b0;
            line-height: 1.6;
            margin-top: 15px;
        }

        /* 左侧参数布局样式 */
        .content-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .left-panel {
            flex: 0 0 400px;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .right-panel {
            flex: 1;
        }

        .param-category {
            margin-bottom: 25px;
        }

        .param-category h3 {
            color: var(--accent-cyan);
            font-size: 1.1em;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
        }

        .param-category .param-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .param-category .param-item {
            display: flex !important;
            flex-direction: row !important;
            /* 强制水平排列 */
            align-items: center !important;
            justify-content: flex-start !important;
            gap: 10px !important;
            padding: 8px 0 !important;
            width: 100% !important;
            min-width: 0 !important;
        }

        .param-category label {
            flex: 0 0 180px !important;
            font-size: 1em !important;
            font-weight: 600 !important;
            color: var(--text-lighter) !important;
            margin: 0 !important;
            /* 移除全局的 margin-bottom */
            white-space: nowrap !important;
        }

        .param-category input {
            flex: 0 0 80px;
            min-width: 60px;
        }

        .param-unit {
            flex: 0 0 40px;
            white-space: nowrap;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .param-controls {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>波前误差分析工具</h1>
            <p>冷湖2米望远镜单模耦合效率分析系统</p>
        </header>

        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-btn" data-tab="system">系统说明与数据流</button>
                <button class="tab-btn" data-tab="formulas">计算公式说明</button>
                <button class="tab-btn active" data-tab="analysis">参数配置与分析</button>
                <button class="tab-btn" data-tab="coupling">单模耦合效率分析</button>
            </div>

            <!-- 参数配置与分析选项卡 -->
            <div id="analysis" class="tab-content active">
                <div class="content-container">
                    <!-- 左侧参数配置面板 -->
                    <div class="left-panel">
                    <!--    <section class="section">   -->
                            <div class="section-header">
                                <h2>系统参数配置</h2>
                                <button id="calculateBtn">计算波前误差</button>
                            </div>

                            <div class="param-category atmosphere">
                                <h3>大气环境参数</h3>
                                <div class="param-group">
                                    <div class="param-item">
                                        <label>大气相干长度 r₀ @550nm</label>
                                        <input type="number" id="r0_ref" value="13.89" step="0.1" min="1" max="30">
                                        <span class="param-unit">cm</span>
                                    </div>
                                    <div class="param-item">
                                        <label>导星波长 λ<sub>g</sub></label>
                                        <input type="number" id="wavelength_guide" value="589" step="1" min="400"
                                            max="1000">
                                        <span class="param-unit">nm</span>
                                    </div>
                                    <div class="param-item">
                                        <label>天顶大气透过率 τ<sub>a</sub></label>
                                        <input type="number" id="tau_a" value="0.9" step="0.05" min="0.1" max="1.0">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>Greenwood频率 f<sub>G</sub></label>
                                        <input type="number" id="f_G" value="30" step="5" min="10" max="500">
                                        <span class="param-unit">Hz</span>
                                    </div>
                                </div>
                            </div>

                            <div class="param-category telescope">
                                <h3>望远镜系统参数</h3>
                                <div class="param-group">
                                    <div class="param-item">
                                        <label>望远镜口径 D</label>
                                        <input type="number" id="D" value="2.0" step="0.1" min="0.5" max="10">
                                        <span class="param-unit">m</span>
                                    </div>
                                    <div class="param-item">
                                        <label>遮拦比 ε</label>
                                        <input type="number" id="epsilon" value="0.18" step="0.01" min="0" max="0.5">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>仰角 z</label>
                                        <input type="number" id="elevation" value="60" step="1" min="0" max="90">
                                        <span class="param-unit">°</span>
                                    </div>
                                    <div class="param-item">
                                        <label>光学系统效率 τ<sub>o</sub></label>
                                        <input type="number" id="tau_o" value="0.8" step="0.05" min="0.1" max="1.0">
                                        <span class="param-unit">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="param-category ao">
                                <h3>自适应光学参数</h3>
                                <div class="param-group">
                                    <div class="param-item">
                                        <label>哈特曼单元数 N</label>
                                        <input type="number" id="N" value="468" step="10" min="50" max="1000">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>帧频 f<sub>frame</sub></label>
                                        <input type="number" id="f_frame" value="1000" step="10" min="100" max="5000">
                                        <span class="param-unit">Hz</span>
                                    </div>
                                    <div class="param-item">
                                        <label>系统带宽比</label>
                                        <input type="number" id="f_e3db_ratio" value="10" step="1" min="5" max="35">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>拟合误差系数 k<sub>fit</sub></label>
                                        <input type="number" id="k_fitting" value="0.3" step="0.05" min="0.1" max="1.0">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>杂项误差 σ²<sub>misc</sub></label>
                                        <input type="number" id="sigma_miscel" value="0.01" step="0.01" min="0"
                                            max="0.5">
                                        <span class="param-unit">rad²</span>
                                    </div>
                                </div>
                            </div>

                            <div class="param-category sensor">
                                <h3>波前传感器参数</h3>
                                <div class="param-group">
                                    <div class="param-item">
                                        <label>导星星等</label>
                                        <input type="number" id="magnitude" value="8.0" step="0.1" min="0" max="20">
                                        <span class="param-unit">mag</span>
                                    </div>
                                    <div class="param-item">
                                        <label>量子效率 η</label>
                                        <input type="number" id="eta" value="0.9" step="0.05" min="0.1" max="1.0">
                                        <span class="param-unit">-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>读出噪声 σ<sub>R</sub></label>
                                        <input type="number" id="sigma_R" value="0.3" step="0.1" min="0" max="5">
                                        <span class="param-unit">e-</span>
                                    </div>
                                    <div class="param-item">
                                        <label>暗电流 I<sub>D</sub></label>
                                        <input type="number" id="I_D" value="0.01" step="0.01" min="0" max="1">
                                        <span class="param-unit">e-/s</span>
                                    </div>
                                    <div class="param-item">
                                        <label>子光斑像素数 K</label>
                                        <input type="number" id="K" value="9" step="1" min="4" max="64">
                                        <span class="param-unit">-</span>
                                    </div>
                                </div>
                            </div>

                            <div class="param-category observation">
                                <h3>观测参数</h3>
                                <div class="param-group">
                                    <div class="param-item">
                                        <label>观测波长 λ<sub>obs</sub></label>
                                        <input type="number" id="wavelength_obs" value="1550" step="10" min="1000" max="2000">
                                        <span class="param-unit">nm</span>
                                    </div>
                                    <div class="param-item">
                                        <label>非等晕角距离 θ<sub>iso</sub></label>
                                        <input type="number" id="theta_iso" value="10" step="1" min="0" max="100">
                                        <span class="param-unit">μrad</span>
                                    </div>
                                    <div class="param-item">
                                        <label>导星高度 z<sub>LGS</sub></label>
                                        <input type="number" id="z_LGS" value="92" step="1" min="0" max="200">
                                        <span class="param-unit">km</span>
                                    </div>
                                </div>
                            </div>

                            <div class="param-controls">
                                <button id="saveParamsBtn" class="secondary">保存</button>
                                <button id="loadParamsBtn" class="secondary">载入</button>
                                <input type="file" id="fileInput" accept=".json" style="display: none;">
                                <button id="resetBtn" class="secondary">重置</button>
                            </div>
                        </section>
                    </div>

                    <!-- 右侧结果面板 -->
                    <div class="right-panel">
                        <section class="section">
                            <h2>计算结果</h2>

                            <h3>中间计算结果</h3>
                            <div class="intermediate-vars" id="intermediate_vars">
                                <!-- 中间变量将通过JS动态生成 -->
                            </div>

                            <h3>误差分量分析</h3>
                            <div class="error-grid">
                                <div class="result-card" id="fitting_card">
                                    <h3>拟合误差</h3>
                                    <div class="result-value" id="fitting_error">-</div>
                                    <div class="result-desc">空间校正限制 <span id="fitting_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>

                                <div class="result-card" id="temporal_card">
                                    <h3>时间误差</h3>
                                    <div class="result-value" id="temporal_error">-</div>
                                    <div class="result-desc">时间校正限制 <span id="temporal_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>

                                <div class="result-card" id="wfs_card">
                                    <h3>噪声误差</h3>
                                    <div class="result-value" id="wfs_error">-</div>
                                    <div class="result-desc">测量噪声限制 <span id="wfs_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>

                                <div class="result-card" id="iso_card">
                                    <h3>非等晕误差</h3>
                                    <div class="result-value" id="iso_error">-</div>
                                    <div class="result-desc">角度非等晕性 <span id="iso_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>

                                <div class="result-card" id="cone_card">
                                    <h3>圆锥效应</h3>
                                    <div class="result-value" id="cone_error">-</div>
                                    <div class="result-desc">导星圆锥效应 <span id="cone_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>

                                <div class="result-card" id="misc_card">
                                    <h3>杂项误差</h3>
                                    <div class="result-value" id="misc_error">-</div>
                                    <div class="result-desc">其他未建模误差 <span id="misc_variance"
                                            style="color: #a0a0a0; font-size: 0.8em">- rad²</span></div>
                                </div>
                            </div>

                            <h3>最终计算结果</h3>
                            <div class="results-grid">
                                <div class="result-card" id="total_card">
                                    <h3>波前误差</h3>
                                    <div class="result-value" id="total_error">-</div>
                                    <div class="result-desc">@ 导星波长</div>
                                </div>

                                <div class="result-card" id="nm_card">
                                    <h3>波前误差</h3>
                                    <div class="result-value" id="nm_error">-</div>
                                    <div class="result-desc">RMS</div>
                                </div>

                                <div class="result-card" id="sr_card">
                                    <h3>斯特列尔比</h3>
                                    <div class="result-value" id="sr_value">-</div>
                                    <div class="result-desc">成像质量指标 @ 1550nm</div>
                                </div>

                                <div class="result-card" id="eval_card">
                                    <h3>目标评估</h3>
                                    <div class="result-value" id="target_eval">-</div>
                                    <div class="result-desc">λ/6@1550nm (258.3nm)</div>
                                </div>
                            </div>
                        </section>

                        <section class="section">
                            <h2>参数变化分析</h2>

                            <div class="chart-controls">
                                <div class="chart-control-item">
                                    <label>分析参数</label>
                                    <select id="paramSelect">
                                        <option value="r0_ref">r0 (大气相干长度)</option>
                                        <option value="N">哈特曼单元数</option>
                                        <option value="f_frame">帧频</option>
                                        <option value="f_G">Greenwood频率</option>
                                        <option value="magnitude">导星星等</option>
                                        <option value="elevation">仰角</option>
                                    </select>
                                </div>
                                <div class="chart-control-item">
                                    <label>最小值</label>
                                    <input type="number" id="paramMin" value="5" step="1">
                                </div>
                                <div class="chart-control-item">
                                    <label>最大值</label>
                                    <input type="number" id="paramMax" value="20" step="1">
                                </div>
                                <div class="chart-control-item">
                                    <label>步进值</label>
                                    <input type="text" id="paramStep" value="1" placeholder="例: 1 或 0.5">
                                </div>
                                <div class="chart-control-item" style="justify-content: flex-end;">
                                    <button id="updateChartBtn">更新分析图表</button>
                                </div>
                            </div>

                            <div class="single-chart-container">
                                <div class="chart-container">
                                    <canvas id="srChart"></canvas>
                                </div>
                                <div class="chart-container">
                                    <canvas id="nmErrorChart"></canvas>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- 系统说明与数据流选项卡 -->
            <div id="system" class="tab-content">
                <section class="section">
                    <h2>系统说明 - 冷湖2米望远镜单模耦合分析</h2>

                    <div class="scenario-description">
                        <h3>应用场景概述</h3>
                        <p>本系统专门为<span
                                class="scenario-highlight">冷湖天文观测基地2米口径望远镜</span>的单模光纤耦合效率分析而设计。通过计算自适应光学系统补偿后的波前误差，评估<span
                                class="scenario-highlight">斯特列尔比(SR)</span>，进而估计单模耦合效率，为高分辨率光谱观测和系外行星探测提供理论依据。</p>
                        <br>
                        <h3>技术方法</h3>
                        <p>系统采用<span class="scenario-highlight">六分量误差模型</span>，分别计算拟合误差、时间误差、噪声误差、非等晕误差、圆锥效应和杂项误差：</p>
                        <ul>
                            <li><strong>拟合误差</strong>: 与变形镜促动器数量和大气相干长度相关，反映空间校正能力</li>
                            <li><strong>时间误差</strong>: 与Greenwood频率和系统带宽相关，反映时间校正能力</li>
                            <li><strong>噪声误差</strong>: 与导星亮度、探测器性能相关，反映测量精度</li>
                            <li><strong>非等晕误差</strong>: 与导星和目标星之间的角距离相关，反映角度非等晕性</li>
                            <li><strong>圆锥效应</strong>: 与导星高度相关，反映激光导星的圆锥效应</li>
                            <li><strong>杂项误差</strong>: 包含校准、对准等未建模误差源</li>
                        </ul>
                        <br>
                        <h3>参数影响分析</h3>
                        <p>通过旋转关键参数配置，系统可分析不同观测条件下自适应光学系统的性能表现：</p>
                        <ul>
                            <li><strong>大气条件</strong>: r0值直接影响拟合误差，优良台址可显著提升性能</li>
                            <li><strong>导星特性</strong>: 星等和波长决定信噪比，影响噪声误差分量</li>
                            <li><strong>系统配置</strong>: 变形镜和哈特曼单元数、帧频等参数需要优化平衡</li>
                            <li><strong>观测几何</strong>: 仰角影响大气路径长度和湍流强度</li>
                        </ul>
                    </div>
                </section>

                <section class="section">
                    <h2>波前残差与斯特列尔比关系分析</h2>

                    <div
                        style="margin-bottom: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                        <h3>理论公式</h3>
                        <div style="text-align: center; font-family: monospace; font-size: 1.2em; margin: 15px 0;">
                            SR = exp(-(2π/λ)<sup>2</sup> × σ<sub>nm</sub><sup>2</sup>)
                        </div>
                        <p><strong>参数说明：</strong></p>
                        <ul>
                            <li><strong>SR</strong>：斯特列尔比，反映波前质量对成像质量的影响</li>
                            <li><strong>λ</strong>：波长（nm），不同波长对应不同的SR值</li>
                            <li><strong>σ<sub>nm</sub></strong>：波前误差的均方根值（nm）</li>
                        </ul>
                    </div>

                    <div class="single-chart-container">
                        <div class="chart-container">
                            <canvas id="wavefrontSRChart"></canvas>
                        </div>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                        <h3>关键阈值参考（基于1550nm观测波长）</h3>
                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin: 15px 0;">

                            <div style="padding: 10px; background: rgba(255, 193, 7, 0.2); border-radius: 5px;">
                                <strong>λ/10 (~155nm)</strong><br>SR = 67.0%
                            </div>
                            <div style="padding: 10px; background: rgba(255, 152, 0, 0.2); border-radius: 5px;">
                                <strong>λ/8 (~194nm)</strong><br>SR = 52.8%
                            </div>
                            <div style="padding: 10px; background: rgba(244, 67, 54, 0.2); border-radius: 5px;">
                                <strong>λ/6 (~258nm)</strong><br>SR = 28.7%
                            </div>
                            <div style="padding: 10px; background: rgba(103, 58, 183, 0.2); border-radius: 5px;">
                                <strong>λ/4 (~387nm)</strong><br>SR = 7.2%
                            </div>
                            <div style="padding: 10px; background: rgba(63, 81, 181, 0.2); border-radius: 5px;">
                                <strong>λ/3 (~517nm)</strong><br>SR = 1.8%
                            </div>
                        </div>
                        <p style="margin-top: 10px;">
                            <strong>说明：</strong>图表展示了波前误差在0-500nm范围内，导星波长(589nm)和观测波长(1550nm)对应的斯特列尔比变化趋势。SR值基于Marechal近似公式计算。
                        </p>
                    </div>
                </section>

                <section class="section">
                    <h2>数据流与计算流程</h2>
                    <p>本系统采用标准化的数据处理流程，从输入参数到最终结果，确保计算过程的透明性和可重复性。</p>

                    <div class="data-flow-diagram">
                        <div class="data-flow-group">
                            <div class="data-flow-title">输入参数</div>
                            <div class="data-flow-item">
                                <span class="param-name">大气参数</span>
                                <span class="param-symbol">r<sub>0</sub>, 仰角</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">望远镜参数</span>
                                <span class="param-symbol">D, ε</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">AO系统参数</span>
                                <span class="param-symbol">N, f<sub>frame</sub></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">导星参数</span>
                                <span class="param-symbol">mag, λ<sub>guide</sub></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">观测参数</span>
                                <span class="param-symbol">λ<sub>obs</sub>, f</span>
                            </div>
                        </div>

                        <div class="data-flow-group">
                            <div class="data-flow-title">中间计算</div>
                            <div class="data-flow-item">
                                <span class="param-name">大气校正</span>
                                <span class="param-symbol">r<sub>0,act</sub> = r<sub>0</sub> ×
                                    cos(z)<sup>3/5</sup></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">信噪比计算</span>
                                <span class="param-symbol">SNR = S<sub>M</sub> / √(...)</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">系统带宽</span>
                                <span class="param-symbol">f<sub>e3db</sub> = f<sub>frame</sub> / ratio</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">子孔径直径</span>
                                <span class="param-symbol">D<sub>sub</sub> = D / √N</span>
                            </div>
                        </div>

                        <div class="data-flow-group">
                            <div class="data-flow-title">误差分量</div>
                            <div class="data-flow-item">
                                <span class="param-name">拟合误差</span>
                                <span class="param-symbol">σ²<sub>fit</sub> = k<sub>fit</sub> ×
                                    (D/r<sub>0,guide</sub>)<sup>5/3</sup> × N<sup>-5/6</sup></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">时间误差</span>
                                <span class="param-symbol">σ²<sub>temp</sub> =
                                    (f<sub>G</sub>/f<sub>e3db</sub>)<sup>5/3</sup></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">噪声误差</span>
                                <span class="param-symbol">σ²<sub>wfs</sub> = 2π² × √[(3/16)² + (s/8)²] / SNR</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">杂项误差</span>
                                <span class="param-symbol">σ²<sub>misc</sub> = 输入值</span>
                            </div>
                        </div>

                        <div class="data-flow-group">
                            <div class="data-flow-title">最终结果</div>
                            <div class="data-flow-item">
                                <span class="param-name">总波前误差</span>
                                <span class="param-symbol">σ²<sub>total</sub> = Σσ²<sub>i</sub></span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">斯特列尔比</span>
                                <span class="param-symbol">SR = exp(-σ<sub>total</sub>²)</span>
                            </div>
                            <div class="data-flow-item">
                                <span class="param-name">耦合效率</span>
                                <span class="param-symbol">η<sub>total</sub> = SR × η<sub>mode</sub> ×
                                    η<sub>jitter</sub></span>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- 单模耦合效率分析选项卡 -->
            <div id="coupling" class="tab-content">
                <div class="content-container">
                    <!-- 左侧参数配置面板 -->
                    <div class="left-panel">
                        <!-- 参数分类 -->
                        <div class="section-header">
                            <h3>光纤耦合计算</h3>
                            <button id="calculateCouplingBtn">计算耦合效率</button>
                        </div>
                        <div class="param-category coupling">
                        <h3>光纤参数</h3>
                        <div class="param-group">
                            <div class="param-item">
                                <label>观测波长</label>
                                <input type="number" id="coupling_wavelength_input" value="1550" step="10" min="1000" max="2000">
                                <span class="param-unit">nm</span>
                            </div>
                            <div class="param-item">
                                <label>系统等效焦距</label>
                                <input type="number" id="coupling_focal_length_input" value="30.0" step="1.0" min="10" max="100">
                                <span class="param-unit">m</span>
                            </div>
                            <div class="param-item">
                                <label>光纤模场直径</label>
                                <input type="number" id="coupling_mfd_input" value="10.4" step="0.1" min="5" max="20">
                                <span class="param-unit">μm</span>
                            </div>
                            <div class="param-item">
                                <label>跟踪误差</label>
                                <input type="number" id="coupling_tracking_error_input" value="1.0" step="0.1" min="0" max="10">
                                <span class="param-unit">mas</span>
                            </div>
                        </div>
                    </div>
                 </div>
            
                    <!-- 右侧结果面板 -->
                    <div class="right-panel">
                        <section class="section">
                            <div class="section-header">
                                <h2>耦合效率计算结果</h2>
                            </div>
            
                            <div class="results-grid">
                                <div class="result-card">
                                    <h3>总耦合效率</h3>
                                    <div class="result-value" id="coupling_total">-</div>
                                    <div class="result-desc">包含所有影响因素</div>
                                </div>
            
                                <div class="result-card">
                                    <h3>观测波长SR</h3>
                                    <div class="result-value" id="coupling_SR_obs">-</div>
                                    <div class="result-desc" id="coupling_sr_desc">@1550nm波长</div>
                                </div>
            
                                <div class="result-card">
                                    <h3>模式匹配效率</h3>
                                    <div class="result-value" id="coupling_mode">-</div>
                                    <div class="result-desc">光纤模式匹配</div>
                                </div>
            
                                <div class="result-card">
                                    <h3>跟瞄效率</h3>
                                    <div class="result-value" id="coupling_tracking">-</div>
                                    <div class="result-desc">望远镜跟踪精度</div>
                                </div>
                            </div>
            
                            <!-- 可以在这里添加图表或详细结果 -->
                            <div class="chart-container" style="margin-top: 30px; height: 300px;">
                                <p style="text-align: center; color: #888; padding: 50px;">
                                    耦合效率分析图表区域
                                    <br>
                                    <small>计算结果将在此处可视化</small>
                                </p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- 计算公式说明选项卡 -->
            <div id="formulas" class="tab-content">
                <section class="section">
                    <h2>波前误差与单模耦合效率计算公式</h2>
                    <p>本系统基于自适应光学系统的六分量误差理论，详细展示了从大气参数到最终耦合效率的完整计算过程。</p>
                </section>

                <section class="section">
                    <h2>1. 总波前误差方差计算</h2>

                    <div class="formula-card">
                        <div class="formula-title">总波前误差方差</div>
                        <div class="formula-expression">
                            σ²<sub>total</sub> = σ²<sub>fit</sub> + σ²<sub>temp</sub> + σ²<sub>wfs</sub> +
                            σ²<sub>iso</sub> + σ²<sub>cone</sub> + σ²<sub>misc</sub>
                        </div>
                        <div class="formula-explanation">
                            总波前误差方差由六个主要分量组成：拟合误差、时间误差、噪声误差、非等晕误差、圆锥效应和杂项误差
                        </div>
                    </div>
                </section>

                <section class="section">
                    <h2>2. 误差分量计算公式</h2>

                    <div class="formula-group">
                        <h3>2.1 拟合误差</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                σ²<sub>fit</sub> = k<sub>fit</sub> × (D/r<sub>0,guide</sub>)<sup>5/3</sup> ×
                                N<sup>-5/6</sup>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>k<sub>fit</sub>：拟合误差系数（通常取0.3-0.5）</li>
                                    <li>D：望远镜口径（m）</li>
                                    <li>r<sub>0,guide</sub>：导星波长下的大气相干长度（m）</li>
                                    <li>N：变形镜促动器数量</li>
                                </ul>
                                <strong>物理意义：</strong>反映自适应光学系统的空间校正能力
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>2.2 时间误差</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                σ²<sub>temp</sub> = (f<sub>G</sub>/f<sub>e3db</sub>)<sup>5/3</sup>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>f<sub>G</sub>：Greenwood频率（Hz），反映大气湍流变化速度</li>
                                    <li>f<sub>e3db</sub>：系统带宽（Hz），f<sub>e3db</sub> = f<sub>frame</sub>/ratio
                                    </li>
                                </ul>
                                <strong>物理意义：</strong>反映自适应光学系统的时间校正能力
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>2.3 噪声误差</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                σ²<sub>wfs</sub> = 2π² × √[(3/16)² + (s/8)²] / SNR
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>SNR：信噪比，与导星亮度、探测器性能相关</li>
                                    <li>s：光源几何因子，对于无穷远恒星 s = 0</li>
                                    <li>常数项：√[(3/16)² + (s/8)²] = 3/16 （当s=0时）</li>
                                </ul>
                                <strong>物理意义：</strong>反映波前传感器的测量精度，包含倾斜噪声和测量噪声
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>2.4 非等晕误差</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                σ²<sub>iso</sub> = (θ<sub>iso</sub>/θ<sub>0</sub>)<sup>5/3</sup>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>θ<sub>iso</sub>：非等晕角距离（角秒）</li>
                                    <li>θ<sub>0</sub>：等晕角，与大气湍流结构相关</li>
                                </ul>
                                <strong>物理意义：</strong>反映导星与观测目标之间的角度差异导致的校正误差
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>2.5 圆锥效应</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                σ²<sub>cone</sub> = (D/z<sub>LGS</sub>)<sup>5/3</sup>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>D：望远镜口径（m）</li>
                                    <li>z<sub>LGS</sub>：激光导星高度（m）</li>
                                </ul>
                                <strong>物理意义：</strong>反映激光导星圆锥效应导致的校正误差
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <h2>3. 中间变量计算</h2>

                    <div class="formula-group">
                        <h3>3.1 信噪比计算</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                SNR = S<sub>M</sub> / √(S<sub>M</sub> + σ<sub>R</sub>² +
                                I<sub>D</sub>t<sub>int</sub>)
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>S<sub>M</sub>：信号电子数，与导星亮度、积分时间、探测器面积相关</li>
                                    <li>σ<sub>R</sub>：读出噪声（电子数）</li>
                                    <li>I<sub>D</sub>：暗电流（电子数/秒）</li>
                                    <li>t<sub>int</sub>：积分时间（秒）</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>3.2 大气相干长度修正</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                r<sub>0,act</sub> = r<sub>0</sub> × cos(z)<sup>3/5</sup>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>r<sub>0</sub>：天顶方向大气相干长度</li>
                                    <li>z：天顶角，z = 90° - 仰角</li>
                                </ul>
                                <strong>物理意义：</strong>考虑大气路径长度对大气相干长度的影响
                            </div>
                        </div>
                    </div>
                </section>

                <section class="section">
                    <h2>4. 单模光纤耦合效率计算</h2>

                    <div class="formula-group">
                        <h3>4.1 斯特列尔比计算</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                SR = exp(-σ<sub>total</sub>²)
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>σ<sub>total</sub>：总波前误差（rad）</li>
                                </ul>
                                <strong>物理意义：</strong>基于Marechal近似，反映波前质量对成像质量的影响
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>4.2 波长依赖的斯特列尔比</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                SR<sub>target</sub> = exp(-(2π/λ<sub>target</sub>)² × σ<sub>nm</sub>²)
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>λ<sub>target</sub>：目标波长（1550nm）</li>
                                    <li>σ<sub>nm</sub>：波前误差（nm）</li>
                                </ul>
                                <strong>物理意义：</strong>将波前误差转换为特定波长下的斯特列尔比
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>4.3 模式匹配效率计算</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                η<sub>mode</sub> = exp[-(π × MFD × σ<sub>tilt</sub> / (4λ × f<sub>eff</sub>))²]
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>MFD：光纤模场直径（m）</li>
                                    <li>σ<sub>tilt</sub>：倾斜误差（rad），包含跟踪误差</li>
                                    <li>λ：观测波长（m）</li>
                                    <li>f<sub>eff</sub>：系统等效焦距（m）</li>
                                </ul>
                                <strong>物理意义：</strong>反映光纤模式与望远镜光斑的匹配程度，主要受跟踪精度和焦距影响
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>4.4 跟瞄效率计算</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                η<sub>jitter</sub> = exp[-(2π × θ<sub>jitter</sub> / λ)²]
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>θ<sub>jitter</sub>：跟踪误差角（rad）</li>
                                    <li>λ：观测波长（m）</li>
                                </ul>
                                <strong>物理意义：</strong>反映望远镜跟踪精度对光纤耦合效率的影响，跟踪误差越大，耦合效率越低
                            </div>
                        </div>
                    </div>

                    <div class="formula-group">
                        <h3>4.5 总单模耦合效率</h3>
                        <div class="formula-card">
                            <div class="formula-expression">
                                η<sub>total</sub> = SR<sub>target</sub> × η<sub>mode</sub> ×
                                η<sub>jitter</sub>
                            </div>
                            <div class="formula-explanation">
                                <strong>参数说明：</strong>
                                <ul>
                                    <li>SR<sub>target</sub>：目标波长下的斯特列尔比</li>
                                    <li>η<sub>mode</sub>：模式匹配效率，根据计算得出</li>
                                    <li>η<sub>jitter</sub>：跟瞄效率，根据计算得出</li>
                                </ul>
                                <strong>物理意义：</strong>综合考虑波前质量、模式匹配和跟瞄精度对单模耦合效率的影响
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>
    </div>

    <script>
        // 波前误差分析类
        class WavefrontErrorAnalysis {
            constructor() {
                this.wavelength_r0_ref = 550e-9; // r0参考波长(m)
            }

            calculateZenithAngle(elevation_deg) {
                const elevation_rad = elevation_deg * Math.PI / 180;
                return Math.PI / 2 - elevation_rad;
            }

            calculateR0AtElevation(r0_ref, elevation_deg) {
                const z = this.calculateZenithAngle(elevation_deg);
                return r0_ref * Math.pow(Math.cos(z), 3 / 5);
            }

            calculateTauAAtElevation(tau_a_zenith, elevation_deg) {
                const z = this.calculateZenithAngle(elevation_deg);
                const sec_z = 1 / Math.cos(z);
                return Math.pow(tau_a_zenith, sec_z);
            }

            calculateR0AtWavelength(r0_ref, wavelength) {
                return r0_ref * Math.pow(wavelength / this.wavelength_r0_ref, 1.2);
            }

            calculateFGuideAtWavelength(f_G, wavelength_guide, wavelength_obs) {
                return f_G * Math.pow(wavelength_guide / wavelength_obs, 6 / 5);
            }

            calculatePhotonFlux(magnitude) {
                const phi_cm2 = 4e6 * Math.pow(10, -magnitude / 2.5);
                return phi_cm2 * 1e4;
            }

            calculateSquareSubaperture(D, N) {
                return D / Math.sqrt(N);
            }

            calculateSignalElectrons(magnitude, f_frame, N, D, eta, tau_a, tau_o) {
                const phi_s = this.calculatePhotonFlux(magnitude);
                const t_int = 1.0 / f_frame;
                const D_sub = this.calculateSquareSubaperture(D, N);
                const A_sub = Math.pow(D_sub, 2); // 方形孔径面积
                return (phi_s * eta * t_int * A_sub * tau_a * tau_o); 
               //const A_effective = A_sub * (1 - Math.pow(epsilon, 2));
               //return (phi_s * eta * t_int * A_effective * tau_a * tau_o) / K;  
            }

            calculateSNR(magnitude, f_frame, N, D, eta, tau_a, tau_o, sigma_R, I_D, K) {
                const S_M = this.calculateSignalElectrons(magnitude, f_frame, N, D, eta, tau_a, tau_o);
                const t_int = 1.0 / f_frame;
                const wfs_variance = S_M + K*(Math.pow(sigma_R, 2) + t_int * I_D);
                return wfs_variance > 0 ? S_M / Math.sqrt(wfs_variance) : 0;
            }

            sigmaFittingSquared(r0_ref, wavelength_guide, D, N, k_fitting) {
                const r0_guide = this.calculateR0AtWavelength(r0_ref, wavelength_guide);
                const term = Math.pow(D / r0_guide, 5 / 3);
                return k_fitting * term * Math.pow(N, -5 / 6);
            }

            sigmaTemporalSquared(f_G, f_frame, f_e3db_ratio, elevation, wavelength_guide) {
                const f_e3db = f_frame / f_e3db_ratio;

                // 考虑仰角对Greenwood频率的影响
                // 根据大气湍流理论，f_G与大气路径长度相关，仰角会影响湍流强度
                // f_G_effective = f_G * (cos(z))^3/5，其中z为天顶距
                const zenith_angle_rad = (90 - elevation) * Math.PI / 180;
                const cos_z = Math.cos(zenith_angle_rad);
                const f_G_effective = f_G * Math.pow(cos_z, 3 / 5);

                return Math.pow(f_G_effective / f_e3db, 5 / 3);
            }

            sigmaWfsSquared(magnitude, f_frame, N, D, epsilon, eta, tau_a, tau_o, sigma_R, I_D, K) {
                const SNR = this.calculateSNR(magnitude, f_frame, N, D, eta, tau_a, tau_o, sigma_R, I_D, K);
                if (SNR > 0) {
                    // SHWFS噪声误差计算中的s参数
                    // 根据用户要求：s = D_guide / L * (D*/sqrt(N)) / wavelength_guide
                    // D_guide = 0.5m, L = 92km, D* = 2m, wavelength_guide = 589e-9
                    const D_guide = 0.5; // 导星望远镜口径
                    const L = 92000; // 导星高度，92km
                    const D_star = 2.0; // 主望远镜口径
                    const wavelength_guide = 589e-9; // 导星波长

                    const s = (D_guide / L) * (D_star / Math.sqrt(N)) / wavelength_guide;

                    const constant_term = Math.sqrt(Math.pow(3 / 16, 2) + Math.pow(s / 8, 2));
                    return 2 * Math.pow(Math.PI, 2) * constant_term / SNR;
                } else {
                    return 1e6; // 极大值，表示无法测量
                }
            }

            // 非等晕误差计算（角度非等晕性）
            sigmaAnisoplanatismSquared(theta, theta_0) {
                if (theta <= 0) return 0; // 自然导星或零角距离时忽略
                return Math.pow(theta / theta_0, 5 / 3);
            }

            // 等晕角计算
            calculateTheta0(r0, L) {
                return 0.6 * r0 / L;
            }

            // 导星圆锥效应误差计算
            sigmaConeSquared(D, d_0) {
                if (d_0 <= 0) return 0;
                return Math.pow(D / d_0, 5 / 3);
            }

            // 计算d_0参数（钠导星经验公式）
            calculateD0(z_LGS) {
                return 0.046 * z_LGS + 0.42; // SLC夜间模型经验公式
            }

            totalWavefrontErrorSquared(params) {
                const r0_ref_m = params.r0_ref / 100;
                const wavelength_guide_m = params.wavelength_guide * 1e-9;

                const r0_actual = this.calculateR0AtElevation(r0_ref_m, params.elevation);
                const tau_a_actual = this.calculateTauAAtElevation(params.tau_a, params.elevation);

                // 基本误差分量
                const sigma2_fitting = this.sigmaFittingSquared(r0_actual, wavelength_guide_m, params.D, params.N, params.k_fitting);
                const sigma2_temporal = this.sigmaTemporalSquared(params.f_G, params.f_frame, params.f_e3db_ratio, params.elevation, wavelength_guide_m);
                const sigma2_wfs = this.sigmaWfsSquared(
                    params.magnitude, params.f_frame, params.N, params.D, params.epsilon,
                    params.eta, tau_a_actual, params.tau_o, params.sigma_R, params.I_D, params.K
                );

                // 扩展误差分量
                const theta_0 = this.calculateTheta0(r0_actual, 5000); // 湍流等效高度取5000米
                const sigma2_iso = this.sigmaAnisoplanatismSquared(params.theta_iso || 0, theta_0);

                const d_0 = this.calculateD0(params.z_LGS || 92); // 钠导星高度92km
                const sigma2_cone = this.sigmaConeSquared(params.D, d_0);

                // 杂项误差（保持原值，但需要添加新的误差分量）
                const sigma2_misc = params.sigma_miscel || 0.05;

                // 总波前误差方差
                const total_variance = sigma2_fitting + sigma2_temporal + sigma2_wfs +
                    sigma2_iso + sigma2_cone + sigma2_misc;

                return {
                    total: total_variance,
                    fitting: sigma2_fitting,
                    temporal: sigma2_temporal,
                    wfs: sigma2_wfs,
                    iso: sigma2_iso,
                    cone: sigma2_cone,
                    miscel: sigma2_misc
                };
            }

            calculateStrehlRatio(sigma_total) {
                return Math.exp(-Math.pow(sigma_total, 2));
            }

            calculateSRAtWavelength(sigma_total, wavelength_guide, wavelength_obs) {
                // 斯特列尔比公式：SR = exp(-(σ * λ_guide /λ_obs)^2)
                return Math.exp(-Math.pow(sigma_total * wavelength_guide / wavelength_obs, 2));
            }

            // 单模光纤耦合效率计算
            calculateSingleModeCoupling(sigma_total, coupling_params) {
                const wavelength_obs = coupling_params.wavelength_obs * 1e-9; // 观测波长(nm转换为m)
                const wavelength_guide = 589e-9; // 固定导星波长

                // 计算观测波长下的斯特列尔比
                const SR_obs = this.calculateSRAtWavelength(sigma_total, wavelength_guide, wavelength_obs);

                // 计算跟瞄效率 (基于光斑抖动公式)
                const tracking_error_rad = coupling_params.tracking_error * 1e-6; // μrad转换为rad
                const MFD_m = coupling_params.mfd * 1e-6; // μm转换为m
                const focal_length = coupling_params.focal_length;

                // 使用新公式：1/[8((f*theta_jitter_rms)/MFD)^2 + 1]
                const f_theta_MFD = focal_length * tracking_error_rad / MFD_m;
                const eta_jitter = 1 / (1 + 8 * Math.pow(f_theta_MFD, 2));

                // 计算模式匹配效率 (基于光纤参数和跟踪误差)
                const sigma_tilt = tracking_error_rad; // 使用跟踪误差作为倾斜误差
                const eta_mode = Math.exp(-Math.pow(Math.PI * MFD_m * sigma_tilt / (4 * wavelength_obs * focal_length), 2));

                // 总耦合效率
                const eta_total = SR_obs * eta_mode * eta_jitter;

                return {
                    total: eta_total,
                    mode_matching: eta_mode,
                    tracking: eta_jitter,
                    strehl_ratio: SR_obs,
                    wavelength_obs: coupling_params.wavelength_obs,
                    focal_length: coupling_params.focal_length,
                    mfd: coupling_params.mfd,
                    tracking_error: coupling_params.tracking_error
                };
            }

            // 单模光纤耦合效率计算（直接使用前面计算的SR值）
            calculateSingleModeCouplingWithSR(SR_obs, coupling_params) {
                const wavelength_obs = coupling_params.wavelength_obs * 1e-9; // 观测波长(nm转换为m)

                // 计算跟瞄效率 (基于光斑抖动公式)
                const tracking_error_rad = coupling_params.tracking_error * 1e-6; // μrad转换为rad
                const MFD_m = coupling_params.mfd * 1e-6; // μm转换为m
                const focal_length = coupling_params.focal_length;

                // 使用新公式：1/[8(f*theta_jitter_rms/MFD)^2]
                const f_theta_MFD = focal_length * tracking_error_rad / MFD_m;
                const eta_jitter = 1 / (1 + 8 * Math.pow(f_theta_MFD, 2));

                // 计算模式匹配效率 (基于光纤参数和跟踪误差)
                const sigma_tilt = tracking_error_rad; // 使用跟踪误差作为倾斜误差
                const eta_mode = Math.exp(-Math.pow(Math.PI * MFD_m * sigma_tilt / (4 * wavelength_obs * focal_length), 2));

                // 总耦合效率
                const eta_total = SR_obs * eta_mode * eta_jitter;

                return {
                    total: eta_total,
                    mode_matching: eta_mode,
                    tracking: eta_jitter,
                    strehl_ratio: SR_obs,
                    wavelength_obs: coupling_params.wavelength_obs,
                    focal_length: coupling_params.focal_length,
                    mfd: coupling_params.mfd,
                    tracking_error: coupling_params.tracking_error
                };
            }



            getParameterRange(paramName) {
                const ranges = {
                    'r0_ref': { min: 5, max: 20, step: 1 },
                    'N': { min: 100, max: 800, step: 50 },
                    'f_frame': { min: 500, max: 2000, step: 100 },
                    'f_G': { min: 20, max: 200, step: 10 },
                    'magnitude': { min: 5, max: 15, step: 0.5 },
                    'elevation': { min: 30, max: 90, step: 5 }
                };
                return ranges[paramName] || { min: 0, max: 100, step: 10 };
            }

            // 获取所有分析参数的范围配置
            getAllParameterRanges() {
                return {
                    'r0_ref': { min: 5, max: 20, step: 1 },
                    'N': { min: 100, max: 800, step: 50 },
                    'f_frame': { min: 500, max: 2000, step: 100 },
                    'f_G': { min: 20, max: 200, step: 10 },
                    'magnitude': { min: 5, max: 15, step: 0.5 },
                    'elevation': { min: 30, max: 90, step: 5 }
                };
            }
        }

        // 全局变量
        let analyzer = new WavefrontErrorAnalysis();
        let nmErrorChart = null;
        let srChart = null;
        let couplingChart = null;
        let couplingComponentsChart = null;
        let currentParams = {};

        // 选项卡切换
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');

                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                btn.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // 获取输入参数
        function getInputParams() {
            return {
                r0_ref: parseFloat(document.getElementById('r0_ref').value),
                wavelength_guide: parseFloat(document.getElementById('wavelength_guide').value),
                wavelength_obs: parseFloat(document.getElementById('wavelength_obs').value),
                D: parseFloat(document.getElementById('D').value),
                epsilon: parseFloat(document.getElementById('epsilon').value),
                magnitude: parseFloat(document.getElementById('magnitude').value),
                N: parseFloat(document.getElementById('N').value),
                f_frame: parseFloat(document.getElementById('f_frame').value),
                f_G: parseFloat(document.getElementById('f_G').value),
                elevation: parseFloat(document.getElementById('elevation').value),
                k_fitting: parseFloat(document.getElementById('k_fitting').value),
                f_e3db_ratio: parseFloat(document.getElementById('f_e3db_ratio').value),
                theta_iso: parseFloat(document.getElementById('theta_iso').value) * 1e-6, // μrad转换为弧度
                z_LGS: parseFloat(document.getElementById('z_LGS').value),
                sigma_miscel: parseFloat(document.getElementById('sigma_miscel').value),
                eta: parseFloat(document.getElementById('eta').value),
                tau_a: parseFloat(document.getElementById('tau_a').value),
                tau_o: parseFloat(document.getElementById('tau_o').value),
                sigma_R: parseFloat(document.getElementById('sigma_R').value),
                I_D: parseFloat(document.getElementById('I_D').value),
                K: parseFloat(document.getElementById('K').value)
            };
        }

        // 获取分析参数范围设置
        function getAnalysisRanges() {
            // 获取当前界面的范围值
            const currentMin = parseFloat(document.getElementById('paramMin').value);
            const currentMax = parseFloat(document.getElementById('paramMax').value);
            const currentStep = parseFloat(document.getElementById('paramStep').value);

            // 获取所有参数的默认范围
            const defaultRanges = analyzer.getAllParameterRanges();

            // 返回包含当前界面值的分析参数范围
            return {
                'r0_ref': {
                    min: currentMin,
                    max: currentMax,
                    step: currentStep
                },
                'N': defaultRanges.N,
                'f_frame': defaultRanges.f_frame,
                'f_G': defaultRanges.f_G,
                'magnitude': defaultRanges.magnitude,
                'elevation': defaultRanges.elevation
            };
        }

        // 设置输入参数
        function setInputParams(params) {
            for (const key in params) {
                const input = document.getElementById(key);
                if (input) {
                    input.value = params[key];
                }
            }
        }

        // 更新参数范围
        function updateParameterRange() {
            const paramName = document.getElementById('paramSelect').value;
            let range;

            // 如果存在已载入的分析参数范围，优先使用保存的值
            if (window.analysisRanges && window.analysisRanges[paramName]) {
                range = window.analysisRanges[paramName];
            } else {
                // 否则使用默认范围
                range = analyzer.getParameterRange(paramName);
            }

            document.getElementById('paramMin').value = range.min;
            document.getElementById('paramMax').value = range.max;
            document.getElementById('paramStep').value = range.step;
        }

        // 计算并显示结果
        function calculateAndDisplay() {
            try {
                const params = getInputParams();
                currentParams = params;

                const errorSquared = analyzer.totalWavefrontErrorSquared(params);
                const totalError = Math.sqrt(errorSquared.total);

                // 统一使用导星波长进行nm转换（理论修正：波前误差是在导星波长下计算的）
                const wavelength_guide_m = params.wavelength_guide * 1e-9;
                const nmError = totalError * wavelength_guide_m * 1e9 / (2 * Math.PI);

                // 计算导星波长下的斯特列尔比
                const SR_guide = Math.exp(-errorSquared.total);

                // 计算观测波长下的斯特列尔比
                // 正确的斯特列尔比计算公式：SR = exp(-σ²)
                // 波前误差在不同波长下需要按波长比进行缩放
                const wavelength_ratio = params.wavelength_obs / params.wavelength_guide;
                const SR_obs = Math.exp(-errorSquared.total / Math.pow(wavelength_ratio, 2));

                // 目标评估：λ/6@观测波长
                const targetEval = nmError <= (params.wavelength_obs / 6);

                // 更新结果显示
                document.getElementById('total_error').textContent = totalError.toFixed(4) + ' rad';
                document.getElementById('nm_error').textContent = nmError.toFixed(1) + ' nm';
                document.getElementById('sr_value').textContent = (SR_obs * 100).toFixed(1) + '%';
                document.getElementById('target_eval').textContent = targetEval ? '达标' : '未达标';
                document.getElementById('target_eval').style.color = targetEval ? "#4caf50" : "#f44336";
                
                // 更新描述文字
                document.getElementById('sr_card').querySelector('.result-desc').textContent = `成像质量指标 @ ${params.wavelength_obs}nm`;
                document.getElementById('eval_card').querySelector('.result-desc').textContent = `λ/6@1550nm (258.3}nm)`;

                // 更新误差分量（显示nm RMS，统一使用导星波长）
                const radToNm = (rad, wavelength) => rad * wavelength * 1e9 / (2 * Math.PI);

                const fittingError_nm = radToNm(Math.sqrt(errorSquared.fitting), wavelength_guide_m);
                const temporalError_nm = radToNm(Math.sqrt(errorSquared.temporal), wavelength_guide_m);
                const wfsError_nm = radToNm(Math.sqrt(errorSquared.wfs), wavelength_guide_m);
                const isoError_nm = radToNm(Math.sqrt(errorSquared.iso), wavelength_guide_m);
                const coneError_nm = radToNm(Math.sqrt(errorSquared.cone), wavelength_guide_m);
                const miscError_nm = radToNm(Math.sqrt(errorSquared.miscel), wavelength_guide_m);

                // 为所有误差分量加上单位"nm"
                document.getElementById('fitting_error').textContent = isNaN(fittingError_nm) ? '-' : fittingError_nm.toFixed(1) + ' nm';
                document.getElementById('temporal_error').textContent = isNaN(temporalError_nm) ? '-' : temporalError_nm.toFixed(1) + ' nm';
                document.getElementById('wfs_error').textContent = isNaN(wfsError_nm) ? '-' : wfsError_nm.toFixed(1) + ' nm';
                document.getElementById('iso_error').textContent = isNaN(isoError_nm) ? '-' : isoError_nm.toFixed(1) + ' nm';
                document.getElementById('cone_error').textContent = isNaN(coneError_nm) ? '-' : coneError_nm.toFixed(1) + ' nm';
                document.getElementById('misc_error').textContent = isNaN(miscError_nm) ? '-' : miscError_nm.toFixed(1) + ' nm';

                // 更新误差分量的rad²方差值
                document.getElementById('fitting_variance').textContent = errorSquared.fitting.toFixed(4) + ' rad²';
                document.getElementById('temporal_variance').textContent = errorSquared.temporal.toFixed(4) + ' rad²';
                document.getElementById('wfs_variance').textContent = errorSquared.wfs.toFixed(4) + ' rad²';
                document.getElementById('iso_variance').textContent = errorSquared.iso.toFixed(4) + ' rad²';
                document.getElementById('cone_variance').textContent = errorSquared.cone.toFixed(4) + ' rad²';
                document.getElementById('misc_variance').textContent = errorSquared.miscel.toFixed(4) + ' rad²';

                // 更新中间变量
                const r0_ref_m = params.r0_ref / 100;
                const r0_actual = analyzer.calculateR0AtElevation(r0_ref_m, params.elevation);
                const tau_a_actual = analyzer.calculateTauAAtElevation(params.tau_a, params.elevation);
                const photon_flux = analyzer.calculatePhotonFlux(params.magnitude);
                const signal_electrons = analyzer.calculateSignalElectrons(
                    params.magnitude, params.f_frame, params.N, params.D,
                    params.eta, tau_a_actual, params.tau_o
                );
                const SNR = analyzer.calculateSNR(
                    params.magnitude, params.f_frame, params.N, params.D,
                    params.eta, tau_a_actual, params.tau_o, params.sigma_R, params.I_D, params.K
                );
                const r0_guide = analyzer.calculateR0AtWavelength(r0_actual, wavelength_guide_m);
                const D_sub = params.D / Math.sqrt(params.N);
                const A_sub = Math.PI * Math.pow(D_sub / 2, 2);
                const A_effective = A_sub * (1 - Math.pow(params.epsilon, 2));
                const f_e3db = params.f_frame / params.f_e3db_ratio;
                const zenith_angle = analyzer.calculateZenithAngle(params.elevation);
                const zenith_distance_deg = zenith_angle * 180 / Math.PI;

                document.getElementById('intermediate_vars').innerHTML = `
                    <div class="var-item">
                        <span class="var-name">天顶距 (度):</span>
                        <span class="var-value">${zenith_distance_deg.toFixed(1)}°</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">斜层r0 (m):</span>
                        <span class="var-value">${r0_actual.toFixed(4)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">斜层大气透过率:</span>
                        <span class="var-value">${tau_a_actual.toFixed(3)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">光子流量密度 (photons/m²-s):</span>
                        <span class="var-value">${photon_flux.toExponential(2)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">信号电子数 (e-):</span>
                        <span class="var-value">${signal_electrons.toFixed(2)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">信噪比 SNR:</span>
                        <span class="var-value">${SNR.toFixed(2)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">导星波长r0 (m):</span>
                        <span class="var-value">${r0_guide.toFixed(4)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">子孔径边长 (m):</span>
                        <span class="var-value">${D_sub.toFixed(3)}</span>
                    </div>
                    <div class="var-item">
                        <span class="var-name">系统带宽 f<sub>e3db</sub> (Hz):</span>
                        <span class="var-value">${f_e3db.toFixed(1)}</span>
                    </div>
                `;

                // 更新数据流图
                updateDataFlow(params, errorSquared, totalError, nmError, SR_guide, r0_actual, r0_guide, D_sub, SNR, f_e3db, photon_flux);

                // 动态更新tooltip内容
                updateTooltips(params, errorSquared, totalError, nmError, SR_obs, r0_actual, r0_guide, D_sub, SNR, f_e3db, photon_flux);
            } catch (error) {
                console.error('计算过程中发生错误:', error);
                alert('计算过程中发生错误，请检查输入参数是否正确。错误信息：' + error.message);
            }
        }

        // 动态更新tooltip内容
        function updateTooltips(params, errorSquared, totalError, nmError, SR_obs, r0_actual, r0_guide, D_sub, SNR, f_e3db, photon_flux) {
            // 计算非等晕角距离theta0作为中间变量
            const theta0 = 0.314 * r0_guide / params.D; // θ₀ = 0.314 × r₀,guide/D
            const theta0_urad = theta0 * 1e6; // 转换为μrad

            // 更新误差分量的tooltip
            const tooltips = {
                'fitting_card': `拟合误差公式: σ²_fit = k_fit × (D/r₀,guide)^(5/3) × N^(-5/6)\n参数: k_fit=${params.k_fitting.toFixed(2)}, D=${params.D.toFixed(1)}m, r₀,guide=${r0_guide.toFixed(4)}m, N=${params.N}`,
                'temporal_card': `时间误差公式: σ²_temp = (f_G/f_e3db)^(5/3)\n参数: f_G=${params.f_G.toFixed(1)}Hz, f_e3db=${f_e3db.toFixed(1)}Hz`,
                'wfs_card': `噪声误差公式: σ²_wfs = 2π² × (3/16) / SNR\n参数: SNR=${SNR.toFixed(2)}, 常数项=3/16 (s=0)`,
                'iso_card': `非等晕误差公式: σ²_iso = (θ_iso/θ₀)^(5/3)\n参数: θ_iso=${params.theta_iso * 1e6}μrad, θ₀=${theta0_urad.toFixed(2)}μrad`,
                'cone_card': `圆锥效应公式: σ²_cone = (D/z_LGS)^(5/3)\n参数: D=${params.D.toFixed(1)}m, z_LGS=${params.z_LGS.toFixed(0)}km (钠导星)`,
                'misc_card': `杂项误差公式: σ²_misc = 输入值\n参数: sigma_miscel=${params.sigma_miscel.toFixed(2)} rad²`,
                'total_card': `总波前误差RMS: σ_total = √(Σσ²_i)\n计算公式: σ²_total = σ²_fit + σ²_temp + σ²_wfs + σ²_iso + σ²_cone + σ²_misc\n@ 导星波长`,
                'nm_card': `波前误差RMS: σ_nm = (λ/2π) × σ_rad\n转换公式: σ_nm = σ_rad × λ_guide / (2π) × 10⁹\nλ_guide = ${params.wavelength_guide}nm`,
                'sr_card': `斯特列尔比: SR = exp(-σ²_obs)\n观测波长下: σ_obs = σ_guide × (λ_guide/λ_obs)\nSR_obs = exp(-[σ_guide × (λ_guide/1550)]²) = ${(SR_obs * 100).toFixed(1)}%`,
                'eval_card': `目标评估: λ/6 @ 1550nm = 258.3nm\n评估标准: σ_nm ≤ 258.3nm 为达标\n当前: ${nmError.toFixed(1)}nm ${nmError <= 258.3 ? '达标' : '未达标'}`
            };

            // 更新所有卡片的title属性
            for (const [id, tooltip] of Object.entries(tooltips)) {
                const element = document.getElementById(id);
                if (element) {
                    element.title = tooltip;
                }
            }
        }

        // 更新数据流图
        function updateDataFlow(params, errorSquared, totalError, nmError, SR, r0_actual, r0_guide, D_sub, SNR, f_e3db, photon_flux) {
            // 数据流图中的元素可能不存在，只更新存在的元素
            const elements = {
                'flow_r0': params.r0_ref + ' cm',
                'flow_wavelength': params.wavelength_guide + ' nm',
                'flow_D': params.D + ' m',
                'flow_N': params.N,
                'flow_magnitude': params.magnitude,
                'flow_fG': params.f_G + ' Hz',
                'flow_r0_act': r0_actual.toFixed(4) + ' m',
                'flow_r0_guide': r0_guide.toFixed(4) + ' m',
                'flow_D_sub': D_sub.toFixed(3) + ' m',
                'flow_SNR': SNR.toFixed(2),
                'flow_fe3db': f_e3db.toFixed(1) + ' Hz',
                'flow_photon_flux': photon_flux.toExponential(2) + ' ph/m²-s',
                'flow_sigma2_fit': errorSquared.fitting.toFixed(4),
                'flow_sigma2_temp': errorSquared.temporal.toFixed(4),
                'flow_sigma2_wfs': errorSquared.wfs.toFixed(4),
                'flow_sigma2_misc': errorSquared.miscel.toFixed(4),
                'flow_sigma2_total': errorSquared.total.toFixed(4),
                'flow_sigma_rms': totalError.toFixed(4) + ' rad',
                'flow_sigma_nm': nmError.toFixed(1) + ' nm',
                'flow_SR': (SR * 100).toFixed(1) + '%',
                'flow_coupling': (SR * 100).toFixed(1) + '%'
            };

            // 只更新存在的元素
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }
        }

        // 更新参数分析图表
        function updateParameterChart() {
            try {
                // 检查图表容器是否存在
                const srChartCanvas = document.getElementById('srChart');
                const nmErrorChartCanvas = document.getElementById('nmErrorChart');

                if (!srChartCanvas || !nmErrorChartCanvas) {
                    console.log('图表容器不存在，跳过图表更新');
                    return;
                }

                const paramName = document.getElementById('paramSelect').value;
                const minVal = parseFloat(document.getElementById('paramMin').value);
                const maxVal = parseFloat(document.getElementById('paramMax').value);
                const stepVal = parseFloat(document.getElementById('paramStep').value);

                // 验证输入参数
                if (isNaN(minVal) || isNaN(maxVal) || isNaN(stepVal) || stepVal <= 0) {
                    alert('请输入有效的参数范围值');
                    return;
                }

                const baseParams = getInputParams();

                // 生成参数值序列
                let paramValues = [];
                for (let val = minVal; val <= maxVal; val += stepVal) {
                    paramValues.push(val);
                }

                // 限制数据点数量，避免性能问题
                if (paramValues.length > 100) {
                    alert('参数范围过大，请减小步长或范围');
                    return;
                }

                const srValues = [];
                const totalNmErrors = [];
                const fittingNmErrors = [];
                const temporalNmErrors = [];
                const wfsNmErrors = [];

                for (let i = 0; i < paramValues.length; i++) {
                    const currentVal = paramValues[i];
                    const testParams = { ...baseParams };
                    testParams[paramName] = currentVal;

                    const errorSquared = analyzer.totalWavefrontErrorSquared(testParams);
                    const totalError = Math.sqrt(errorSquared.total);

                    // 使用观测波长计算斯特列尔比（重要修正）
                    const wavelength_guide_m = testParams.wavelength_guide * 1e-9;
                    const wavelength_obs_m = testParams.wavelength_obs * 1e-9; // 固定观测波长1550nm

                    // 波前误差转换到nm单位
                    const totalError_nm = totalError * wavelength_guide_m * 1e9 / (2 * Math.PI);

                    // 使用观测波长计算斯特列尔比
                    const SR_obs = analyzer.calculateSRAtWavelength(totalError, wavelength_guide_m, wavelength_obs_m);

                    // 将所有误差转换为nm单位（使用导星波长）
                    const fittingError_nm = Math.sqrt(errorSquared.fitting) * wavelength_guide_m * 1e9 / (2 * Math.PI);
                    const temporalError_nm = Math.sqrt(errorSquared.temporal) * wavelength_guide_m * 1e9 / (2 * Math.PI);
                    const wfsError_nm = Math.sqrt(errorSquared.wfs) * wavelength_guide_m * 1e9 / (2 * Math.PI);

                    srValues.push(SR_obs * 100);

                    totalNmErrors.push(totalError_nm);
                    fittingNmErrors.push(fittingError_nm);
                    temporalNmErrors.push(temporalError_nm);
                    wfsNmErrors.push(wfsError_nm);
                }

                // 获取参数显示名称
                const paramLabels = {
                    'r0_ref': 'r0 (cm)',
                    'N': '哈特曼单元数',
                    'f_frame': '帧频 (Hz)',
                    'f_G': 'Greenwood频率 (Hz)',
                    'magnitude': '导星星等',
                    'elevation': '仰角 (度)'
                };

                // 更新斯特列尔比图表（第一张图）
                updateSRChart(paramName, paramValues, paramLabels, srValues);

                // 更新波前误差图表（第二张图，nm单位）
                updateNmErrorChart(paramName, paramValues, paramLabels, totalNmErrors, fittingNmErrors, temporalNmErrors, wfsNmErrors);

            } catch (error) {
                console.error('更新参数分析图表时出错:', error);
                alert('图表更新失败，请检查参数设置');
            }
        }

        // 更新波前误差图表（nm单位）
        function updateNmErrorChart(paramName, paramValues, paramLabels, totalNmErrors, fittingNmErrors, temporalNmErrors, wfsNmErrors) {
            const ctx = document.getElementById('nmErrorChart').getContext('2d');

            if (nmErrorChart) {
                nmErrorChart.destroy();
            }

            nmErrorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: paramValues,
                    datasets: [
                        {
                            label: '总误差',
                            data: totalNmErrors,
                            borderColor: 'rgb(201, 203, 207)',
                            backgroundColor: 'rgba(201, 203, 207, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: '拟合误差',
                            data: fittingNmErrors,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: '时间误差',
                            data: temporalNmErrors,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            pointRadius: 0
                        },
                        {
                            label: '噪声误差',
                            data: wfsNmErrors,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `波前误差RMS随${paramLabels[paramName]}变化（nm单位）`,
                            color: '#e0e0e0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#e0e0e0',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: paramLabels[paramName],
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '波前误差RMS (nm)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    }
                }
            });
        }

        // 更新斯特列尔比图表
        function updateSRChart(paramName, paramValues, paramLabels, srValues) {
            const ctx = document.getElementById('srChart').getContext('2d');

            if (srChart) {
                srChart.destroy();
            }

            srChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: paramValues,
                    datasets: [
                        {
                            label: '斯特列尔比',
                            data: srValues,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `斯特列尔比（使用观测波长计算）随${paramLabels[paramName]}变化`,
                            color: '#e0e0e0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#e0e0e0',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: paramLabels[paramName],
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '斯特列尔比 (%)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    }
                }
            });
        }

        // 保存参数配置
        function saveParameters() {
            const params = getInputParams();
            const analysisRanges = getAnalysisRanges();

            // 包含6项分析参数的范围配置
            const saveData = {
                params: params,
                analysisRanges: analysisRanges
            };

            const dataStr = JSON.stringify(saveData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wavefront_params.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 载入参数配置
        function loadParameters(file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    setInputParams(data.params);

                    // 恢复分析参数范围
                    if (data.analysisRanges) {
                        // 设置当前选中的参数范围
                        const currentParam = document.getElementById('paramSelect').value;
                        if (data.analysisRanges[currentParam]) {
                            document.getElementById('paramMin').value = data.analysisRanges[currentParam].min;
                            document.getElementById('paramMax').value = data.analysisRanges[currentParam].max;
                            document.getElementById('paramStep').value = data.analysisRanges[currentParam].step;
                        }

                        // 保存分析参数范围到全局变量，用于参数切换时恢复
                        window.analysisRanges = data.analysisRanges;
                    }

                    calculateAndDisplay();
                } catch (error) {
                    alert('文件格式错误，无法载入参数');
                }
            };
            reader.readAsText(file);
        }

        // 重置参数为默认值
        function resetParameters() {
            const defaultParams = {
                r0_ref: 10,
                wavelength_guide: 589,
                D: 2.0,
                epsilon: 0.18,
                magnitude: 8.0,
                N: 400,
                f_frame: 1000,
                f_G: 50,
                elevation: 60,
                k_fitting: 0.3,
                f_e3db_ratio: 25,
                sigma_miscel: 0.05,
                eta: 0.9,
                tau_a: 0.9,
                tau_o: 0.8,
                sigma_R: 0.3,
                I_D: 0.01,
                K: 9
            };

            setInputParams(defaultParams);

            // 重置分析参数范围为默认值
            window.analysisRanges = analyzer.getAllParameterRanges();
            updateParameterRange();

            calculateAndDisplay();
        }

        // 事件监听
        document.getElementById('calculateBtn').addEventListener('click', calculateAndDisplay);
        document.getElementById('updateChartBtn').addEventListener('click', updateParameterChart);
        document.getElementById('saveParamsBtn').addEventListener('click', saveParameters);
        document.getElementById('loadParamsBtn').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('resetBtn').addEventListener('click', resetParameters);
        document.getElementById('fileInput').addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                loadParameters(e.target.files[0]);
            }
        });
        document.getElementById('paramSelect').addEventListener('change', updateParameterRange);
        document.getElementById('calculateCouplingBtn').addEventListener('click', calculateCouplingEfficiency);

        // 为绘图控件添加事件监听器
        document.getElementById('paramMin').addEventListener('change', updateParameterChart);
        document.getElementById('paramMax').addEventListener('change', updateParameterChart);
        document.getElementById('paramStep').addEventListener('change', updateParameterChart);

        // 页面加载时初始化图表和波前误差图表
        window.addEventListener('load', function () {
            // 延迟执行，确保DOM完全加载
            setTimeout(() => {
                try {
                    // 初始化全局分析参数范围
                    window.analysisRanges = analyzer.getAllParameterRanges();
                    updateParameterRange();
                    calculateAndDisplay();
                    createWavefrontSRChart(); // 初始化波前误差与斯特列尔比关系图表
                } catch (error) {
                    console.log('初始化失败:', error);
                }
            }, 500);
        });

        // 单独计算耦合效率
        function calculateCouplingEfficiency() {
            // 使用主选项卡计算的总波前误差
            if (!currentParams || Object.keys(currentParams).length === 0) {
                alert('请先在"参数配置与分析"选项卡中计算波前误差');
                return;
            }

            const errorSquared = analyzer.totalWavefrontErrorSquared(currentParams);
            const totalError = Math.sqrt(errorSquared.total);
            const SR = analyzer.calculateStrehlRatio(totalError);
        }

        // 更新耦合效率分析结果
        function updateCouplingResults(couplingResult) {
            document.getElementById('coupling_total').textContent = (couplingResult.total * 100).toFixed(1) + '%';
            document.getElementById('coupling_mode').textContent = (couplingResult.mode_matching * 100).toFixed(1) + '%';
            document.getElementById('coupling_tracking').textContent = (couplingResult.tracking * 100).toFixed(1) + '%';
            document.getElementById('coupling_SR_obs').textContent = (couplingResult.strehl_ratio * 100).toFixed(1) + '%';
            document.getElementById('coupling_sr_desc').textContent = '@' + couplingResult.wavelength_obs + 'nm波长';

            // 更新系统配置参数显示
            document.getElementById('coupling_wavelength').textContent = couplingResult.wavelength_obs + ' nm';
            document.getElementById('coupling_focal_length').textContent = couplingResult.focal_length + ' m';
            document.getElementById('coupling_mfd').textContent = couplingResult.mfd + ' μm';
            document.getElementById('coupling_tracking_error').textContent = couplingResult.tracking_error + ' μrad';
        }

        // 更新耦合效率分析图表
        function updateCouplingChart() {
            const paramName = document.getElementById('couplingParamSelect').value;
            const minVal = parseFloat(document.getElementById('couplingParamMin').value);
            const maxVal = parseFloat(document.getElementById('couplingParamMax').value);
            const stepVal = parseFloat(document.getElementById('couplingParamStep').value);

            const baseParams = getInputParams();

            // 生成参数值序列
            let paramValues = [];
            for (let val = minVal; val <= maxVal; val += stepVal) {
                paramValues.push(val);
            }

            const totalCoupling = [];
            const modeMatching = [];
            const tracking = [];
            const strehlRatio = [];

            for (let i = 0; i < paramValues.length; i++) {
                const currentVal = paramValues[i];
                const testParams = { ...baseParams };
                testParams[paramName] = currentVal;

                const errorSquared = analyzer.totalWavefrontErrorSquared(testParams);
                const totalError = Math.sqrt(errorSquared.total);
                const couplingResult = analyzer.calculateSingleModeCoupling(testParams, totalError);

                totalCoupling.push(couplingResult.total * 100);
                modeMatching.push(couplingResult.mode_matching * 100);
                tracking.push(couplingResult.tracking * 100);
                strehlRatio.push(couplingResult.strehl_ratio * 100);
            }

            // 获取参数显示名称
            const paramLabels = {
                'r0_ref': 'r0 (cm)',
                'N': '哈特曼单元数',
                'f_frame': '帧频 (Hz)',
                'f_G': 'Greenwood频率 (Hz)',
                'magnitude': '导星星等',
                'elevation': '仰角 (度)'
            };

            // 更新耦合效率图表
            updateCouplingChartVisual(paramName, paramValues, paramLabels, totalCoupling, modeMatching, tracking, strehlRatio);

            // 更新耦合效率分量图表
            updateCouplingComponentsChart(paramName, paramValues, paramLabels, totalCoupling, modeMatching, tracking, strehlRatio);
        }

        // 更新耦合效率图表
        function updateCouplingChartVisual(paramName, paramValues, paramLabels, totalCoupling, modeMatching, tracking, strehlRatio) {
            const ctx = document.getElementById('couplingChart').getContext('2d');

            if (couplingChart) {
                couplingChart.destroy();
            }

            couplingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: paramValues,
                    datasets: [
                        {
                            label: '总耦合效率',
                            data: totalCoupling,
                            borderColor: 'rgb(76, 175, 80)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 3
                        },
                        {
                            label: '模式匹配效率',
                            data: modeMatching,
                            borderColor: 'rgb(33, 150, 243)',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: '跟瞄效率',
                            data: tracking,
                            borderColor: 'rgb(255, 152, 0)',
                            backgroundColor: 'rgba(255, 152, 0, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: '斯特列尔比',
                            data: strehlRatio,
                            borderColor: 'rgb(156, 39, 176)',
                            backgroundColor: 'rgba(156, 39, 176, 0.1)',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `耦合效率随${paramLabels[paramName]}变化`,
                            color: '#e0e0e0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: paramLabels[paramName],
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '效率 (%)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // 更新耦合效率分量图表
        function updateCouplingComponentsChart(paramName, paramValues, paramLabels, totalCoupling, modeMatching, tracking, strehlRatio) {
            const ctx = document.getElementById('couplingComponentsChart').getContext('2d');

            if (couplingComponentsChart) {
                couplingComponentsChart.destroy();
            }

            couplingComponentsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: paramValues,
                    datasets: [
                        {
                            label: '模式匹配效率',
                            data: modeMatching,
                            backgroundColor: 'rgba(33, 150, 243, 0.7)',
                            borderColor: 'rgb(33, 150, 243)',
                            borderWidth: 1
                        },
                        {
                            label: '跟瞄效率',
                            data: tracking,
                            backgroundColor: 'rgba(255, 152, 0, 0.7)',
                            borderColor: 'rgb(255, 152, 0)',
                            borderWidth: 1
                        },
                        {
                            label: '其他因素',
                            data: totalCoupling.map((total, index) => {
                                return Math.max(0, total - modeMatching[index] - tracking[index]);
                            }),
                            backgroundColor: 'rgba(156, 39, 176, 0.7)',
                            borderColor: 'rgb(156, 39, 176)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `耦合效率分量分析 - ${paramLabels[paramName]}`,
                            color: '#e0e0e0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: paramLabels[paramName],
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: '效率分量 (%)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // 更新耦合效率参数范围
        function updateCouplingParameterRange() {
            const paramName = document.getElementById('couplingParamSelect').value;
            let range;

            // 如果存在已载入的分析参数范围，优先使用保存的值
            if (window.analysisRanges && window.analysisRanges[paramName]) {
                range = window.analysisRanges[paramName];
            } else {
                // 否则使用默认范围
                range = analyzer.getParameterRange(paramName);
            }

            document.getElementById('couplingParamMin').value = range.min;
            document.getElementById('couplingParamMax').value = range.max;
            document.getElementById('couplingParamStep').value = range.step;
        }

        // 生成固定范围的波前残差与斯特列尔比关系图表
        function createWavefrontSRChart() {
            const canvas = document.getElementById('wavefrontSRChart');
            if (!canvas) {
                console.log('wavefrontSRChart canvas not found');
                return;
            }

            const ctx = canvas.getContext('2d');

            // 固定范围：0-500nm，步进5nm
            const wavefrontErrors = [];
            const srObsValues = []; // 观测波长(1550nm)的SR

            for (let error = 0; error <= 500; error += 5) {
                wavefrontErrors.push(error);

                // 计算观测波长(1550nm)的斯特列尔比
                const errorRadObs = error * 1e-9 / (1550e-9) * 2 * Math.PI;
                const SR_obs = Math.exp(-errorRadObs * errorRadObs);
                srObsValues.push(SR_obs * 100);
            }

            if (window.wavefrontSRChartInstance) {
                window.wavefrontSRChartInstance.destroy();
            }

            window.wavefrontSRChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: wavefrontErrors,
                    datasets: [
                        {
                            label: 'SR@观测波长(1550nm)',
                            data: srObsValues,
                            borderColor: 'rgb(76, 175, 80)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '波前误差与不同波长斯特列尔比关系 (0-300nm)',
                            color: '#ffffff',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '波前误差 (nm)',
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                color: '#ffffff',
                                stepSize: 50
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '斯特列尔比 (%)',
                                color: '#ffffff',
                                font: {
                                    size: 14
                                }
                            },
                            ticks: {
                                color: '#ffffff',
                                callback: function (value) {
                                    return value + '%';
                                }
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // 更新波前误差与耦合效率关系图表
        function updateWavefrontCouplingChart(wavefrontErrors, srValues, couplingEfficiency) {
            const ctx = document.getElementById('wavefrontCouplingChart').getContext('2d');

            if (window.wavefrontCouplingChart) {
                window.wavefrontCouplingChart.destroy();
            }

            window.wavefrontCouplingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: wavefrontErrors,
                    datasets: [
                        {
                            label: '斯特列尔比',
                            data: srValues,
                            borderColor: 'rgb(33, 150, 243)',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: '耦合效率',
                            data: couplingEfficiency,
                            borderColor: 'rgb(76, 175, 80)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: false,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '波前误差与耦合效率关系',
                            color: '#e0e0e0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: '波前误差 (nm)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '效率 (%)',
                                color: '#e0e0e0'
                            },
                            ticks: {
                                color: '#b0b0b0'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }



        // 选项卡切换功能
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');

                // 移除所有选项卡的激活状态
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                // 激活当前选项卡
                btn.classList.add('active');
                const tabContent = document.getElementById(tabId);
                if (tabContent) {
                    tabContent.classList.add('active');
                }

                // 延迟执行图表初始化，确保DOM元素已显示
                setTimeout(() => {
                    if (tabId === 'system') {
                        // 初始化波前残差与斯特列尔比关系图表
                        createWavefrontSRChart();
                    }
                }, 100);
            });
        });

        // 确保页面加载时正确显示初始选项卡
        window.addEventListener('load', function () {
            // 确保只有分析选项卡是激活状态
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            const analysisBtn = document.querySelector('.tab-btn[data-tab="analysis"]');
            const analysisContent = document.getElementById('analysis');

            if (analysisBtn && analysisContent) {
                analysisBtn.classList.add('active');
                analysisContent.classList.add('active');
            }
        });

        // 修改calculateAndDisplay函数，在计算完成后自动更新所有图表
        const originalCalculateAndDisplay = calculateAndDisplay;
        calculateAndDisplay = function () {
            originalCalculateAndDisplay();
            // 自动更新参数分析图表
            setTimeout(() => {
                updateParameterChart();
            }, 200);
        };
    </script>
</body>

</html>